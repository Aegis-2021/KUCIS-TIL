# KUCIS TIL

- 이름: 전호영

- 날짜: 21-08-20

### ⚙️ 오늘 공부한 내용

1. 로그인 화면 만들기 (연습)

- value 입력하는 커스텀 훅 만들기

```tsx
import { Dispatch, SetStateAction, useCallback, useState } from "react";

const useInput = <T = any>(
  initialData: T
): [T, (e: any) => void, Dispatch<SetStateAction<T>>] => {
  const [value, setValue] = useState(initialData);
  const handler = useCallback((e) => {
    setValue(e.target.value);
  }, []);

  return [value, handler, setValue]; // value -> T에 들어온 타입, handler -> 함수 반환 , setValue -> Dispatch<SetStateAction<T>> 암기하기!
};

export default useInput;
```

- axios 사용!

  ```tsx
  axios.post("주소", {body에 들어갈 내용}).
  then((res)=>{"성공했을때..."}).
  catch((err) => {"실패했을떄..."})
  ```

  ```tsx
  axios
    .post("http://localhost:3095/api/users", {
      email,
      nickname,
      password,
    })
    .then((res) => {
      console.log(res);
    })
    .catch((err) => {
      console.log(err.response);
    })
    .finally(() => {});
  ```

- then, catch, finally (비동기 요청) 속에 state가 변경되는 경우가 존재한다면, 비동기요청을 하기 전에 한번 null값으로 state를 초기화시켜줘야 함! 요청을 연달아 보내는 경우, 이전 state가 남아서 다음 state와 동시에 표시되는 경우가 발생할 수 있다.

```tsx
const onSubmit = useCallback(
  (e) => {
    e.preventDefault();
    setSignUpError("");
    setSignUpSuccess(false);
    if (!mismatchError) {
      axios
        .post("http://localhost:3095/api/users", {
          email,
          nickname,
          password,
        })
        .then((res) => {
          setSignUpSuccess(true);
        })
        .catch((err) => {
          setSignUpError(err.response.data);
        })
        .finally(() => {});
    }
  },
  [email, nickname, password, passwordCheck, mismatchError]
);
```

- react는 a태그 대신 link태그 사용함!

- 로그인 성공 시, 어떻게 그 사실을 알 수 있을까?

  - 대게 로그인이 성공하면 서버가 프론트에게 데이터를 준다. 이 데이터를 프론트가 저장하고 있으면 됨(만약 로그아웃을 한다면 프론트에서 그 데이터를 버리면 됨.)
  - swr

    - 전역적 상태관리.
    - 요청을 해서 받아온 데이터를 저장하는 것!(보통 get을 통해 데이터를 갖고옴.)

    ```tsx
    const { data, error } = useSWR("주소", fetcher);
    // useSWR은 주소를 fetcher로 넘겨주기만 함. fetcher에서 주소를 어떻게 처리할지 정해놔야함.

    // fetcher 함수
    const fetcher = (url: string) => {
      axios.get(url).then((res) => {
        return res.data;
      });
    };
    // res.data가 const {data}안으로 들어가게 됨.
    ```

    - withCredentials의 역할!

    ```tsx
    const onSubmit = useCallback(
      (e) => {
        e.preventDefault();
        axios
          .post(
            "http://localhost:3095/api/users/login",
            { email, password },
            { withCredentials: true }
          )
          .then(() => {
            console.log("success");
          })
          .catch((err) => {
            console.log("failed");
            console.log(err.response);
          });
      },
      [email, password]
    );
    ```

    - 쿠키를 생성해 저장함!
      - post의 경우 3번째,
      - get의 경우 2번째에 위치!

### ⚙️ 회고
